#!/bin/bash

MY_PATH="`dirname \"$0\"`"              # relative
MY_PATH="`( cd \"$MY_PATH\" && pwd )`"  # absolutized and normalized
if [ -z "$MY_PATH" ] ; then
	# error; for some reason, the path is not accessible
	# to the script (e.g. permissions re-evaled after suid)
	exit 1  # fail
fi

mkdir -p output
mkdir -p photos

# Convert photos to 300 DPI and max 104x112 mm
# 300 DPI is 11.811 dots-per-millimeter
cd photos
mogrify -density 300 -resize 1228x1322 *
cd ..

node $MY_PATH/generate.js
cd output
pdflatex output.tex
pdflatex output.tex
cp $MY_PATH/templates/output-a4.tex .
pdflatex output-a4.tex
